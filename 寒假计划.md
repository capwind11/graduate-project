寒假计划

目前毕业设计进展简要概述：

最终目标：实现将并发任务乱序打印的日志，分离成各个独立任务打印的日志，分离后的日志可以反映单一任务执行的路径，可用于检测日志中反映的任务执行异常。



目前进展：

1. 日志解析部分：

   以往日志解析需要人工根据日志结构，定义变量的正则表达式进行解析，比如ip、block_id其它执行任务变化的变量。存在的问题包括，（1）需要对日志中变量类型有先验知识；（2）当日志结构或变量格式改变后，方法可能失效

   在分析了spell和drain两种当前主流的日志解析方法的实现后，我计划对drain进行改良。

   drain是使用前缀树的方法来解析日志，前缀树的节点表示token(即当前单词)，token如果与事先规定的变量正则表达式匹配，则用“*”代替。drain规定了最大子节点的数量，如果子节点数目已达到最大值，且构建树时子节点中没有与当前token匹配的节点，则把当前token加入到\*表示的节点。

   存在问题包括：（1）需要人工事先定义变量的正则表达式，如果有遗漏的变量未事先定义，那么构建的树的质量会比较差；（2）原本不同的变量类型，可能共用一个“*”节点，这样的话难以区分不同类型的变量，给该“\*”节点下的子树扩展也带来比较大的压力。

   经观察，在变量部分会分支出大量子树结构相同的节点，根据一定策略，比如节点子节点数量超过最大子节点数量80%时，合并相似子树的节点，可以自动识别出日志语句中的变量部分。并且可以解决上述的两个问题。

2. 日志聚类部分：
   - 直接使用步骤1中drain日志解析后得到的叶节点作为分类依据，这种方法是根据日志条目的结构直接进行分类
   - 用bert对每条日志进行编码，并用编码后的结果进行聚类，这种方法是根据日志条目的语义进行分类，本次毕业设计大概率会使用根据语义进行分类的方法，来实现应用更新迭代导致日志格式变化时，这种分类方法仍然具备鲁棒性。

3. 建立从日志条目类别序号到bert编码的映射缓存

   bert编码的迭代计算有巨大时间开销，基于1和2步骤中完成的日志解析和分类，当产生一条新日志时，前缀树可以迅速解析日志条目，得到对应的类别。再通过类别得到bert编码的映射，可以避免通过bert神经网络运算的巨大开销

4. 分离并发打印日志部分：

   目前许多系统日志都是由并发执行的任务异步打印的，即一段日志中包括了多个任务交叉打印的日志，无法直接从日志中提取出单一任务的执行路径。

   过往的办法主要是通过相同的变量标识符将单一任务执行路径关联起来，比如根据taskid、线程id、block_id等，但对于缺乏这些标识符的日志段，则无法判断日志条目属于哪个任务。

   我计划使用共现模式发现来找到日志中的模式，主要采用lstm网络和密度聚类的方法。主要是基于以下的现象，即属于同一任务执行时打印的日志，出现在同一段日志中频率更大；对不同任务打印的日志，出现在同一段日志中频率要小得多，存在很大随机性。

   借鉴自然语言处理中单词预测的思想，将lstm样本的标签设置为下一条日志，通过不断预测下一条可能出现的日志，可以学习日志中的模式。

   但同一任务中，也存在并发或循环执行的子任务，通过分析lstm的输出结果的概率分布，可以发现这些规律。

   如：存在输入日志序列1—>3—>5，经过lstm预测结果下一条日志条目的概率分布为{4:0.6, 6:0.4}，说明日志5打印后，日志4和6均有很高的打印概率，这有可能是任务存在分支，由if-else逻辑导致的；也可能是并发执行子任务导致的。若下一条日志条目预测的概率全都低于0.2，那么5标志着该任务结束。(以上参数只是为了更方便说明而举例，最好的阈值参数等还需调试)

   

5. 日志异常检测模型

   基于步骤2中lstm网络，我们已经发现了日志序列的规律，因此可以将实时产生的日志作为输入，分离出日志中独立的任务执行路径，并检测日志中是否存在异常模式。



6. 解决鲁棒性问题

   即将以上的样本均经过bert预训练模型编码后再作为模型输入，即将样本改进为日志的语义表示，这样即使日志格式发生变化，模型学习到的日志模式仍然有效。



寒假计划：

1. 按部就班把毕业设计中难点都解决

   - 计划：

     1.24-1.27：drain算法改进完成，构建并存储完整的前缀树

     1.28-2.5：完成日志条目到bert的信息映射缓存建立，目的是为了加速bert对实时输入日志编码速度

     2.6-2.7：完成bert编码后日志条目的聚类

     2.8-2.15：lstm模型的构建和训练

     2.16-2.22：在lstm预测的概率分布基础上，完成分离并发打印的日志中独立的执行路径的算法

     2.23-2.29：将模型的所有部分都组合构建起来

     

2. 每周争取看两篇集群调度方向的论文

